package me.spruce.creeperclient.module.modules.exploits;

import com.mojang.realmsclient.gui.ChatFormatting;
import me.spruce.creeperclient.command.Command;
import me.spruce.creeperclient.module.Category;
import me.spruce.creeperclient.module.Module;
import me.spruce.creeperclient.setting.n.Setting;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.util.math.Vec3d;
import org.lwjgl.input.Keyboard;

import java.util.HashMap;
import java.util.Objects;

public class PearlTracker extends Module {
    private final Setting<Number> distance = register("MinDistance", 10, 10, 200, 10);

    public PearlTracker() {
        super("Pearl Tracker", "Tracks player when it teleports by pearl", Keyboard.KEY_NONE, Category.EXPLOITS);
    }

    private final HashMap<String, Vec3d> PlayersFar = new HashMap<>();

    @Override
    public void update() {
        for (EntityPlayer player : mc.world.playerEntities) {
            if (player == mc.player || player.getName().equals(Objects.requireNonNull(mc.player).getName())) continue;

            if (player.getDistance(mc.player) < 10) {
                if (PlayersFar.containsKey(player.getName())) {
                    Command.sendMessage(ChatFormatting.AQUA + "Removing " + player.getName() + " from list, they are now in range at " + player.getDistance(mc.player) + " distance");
                    PlayersFar.remove(player.getName());
                }
                continue;
            }

            if (PlayersFar.containsKey(player.getName())) continue;

            if (player.getDistance(mc.player) >= distance.getValue().intValue()) {
                PlayersFar.put(player.getName(), new Vec3d(player.posX, player.posY, player.posZ));
                Command.sendMessage(ChatFormatting.AQUA + player.getName() + " just teleported to " + String.format("%.0f", player.posX) + ", "+ String.format("%.1f", player.posZ));
            }
        }
    }
}
